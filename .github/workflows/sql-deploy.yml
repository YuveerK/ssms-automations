name: SSMS Database Automation

on:
  push:
    paths:
      - "DatabaseAdministration/SQLStatements/Database Automation Scripts/*.sql"
    branches:
      - main
  workflow_dispatch:

jobs:
  deploy_to_development:
    name: Deploy to Development (Local) ðŸš§
    uses: ./.github/workflows/sql-deployment-template.yml
    with:
      environment: development
      db_name: ${{ secrets.DB_NAME }}
    secrets:
      db_server: ${{ secrets.DB_SERVER }}
      db_user: ${{ secrets.DB_USER }}
      db_pass: ${{ secrets.DB_PASS }}

  deploy_to_production:
    name: Deploy to Production (Accountability Partner Machine) ðŸš€
    needs: deploy_to_development
    uses: ./.github/workflows/sql-deployment-template.yml
    with:
      environment: production
      db_name: ${{ secrets.PROD_DB_NAME }}
    secrets:
      db_server: ${{ secrets.PROD_DB_SERVER }}
      db_user: ${{ secrets.PROD_DB_USER }}
      db_pass: ${{ secrets.PROD_DB_PASS }}
    concurrency: production
