name: SSMS Database Automation

on:
  push:
    paths:
      - "DatabaseAdministration/SQLStatements/**.sql"
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted # This runs on your local machine

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Execute SQL Scripts
        shell: pwsh
        run: |
          $server = "(local)"  # Change if using a named instance

          # Ensure SQLCMD is installed
          if (-not (Get-Command sqlcmd -ErrorAction SilentlyContinue)) {
            Write-Error "SQLCMD is not installed. Install it from Microsoft SQL Server tools."
            exit 1
          }

          # Execute all SQL scripts in order
          Get-ChildItem -Path "DatabaseAdministration/SQLStatements" -Filter "*.sql" | ForEach-Object {
              Write-Host "Executing script: $($_.Name)..."
              sqlcmd -S $server -i $_.FullName
          }

          Write-Host "âœ… All SQL scripts executed successfully!"
